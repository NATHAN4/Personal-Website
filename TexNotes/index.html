<html>
    <head>
        <link rel="stylesheet" type="text/css" href="..\large.css">
    </head>
    <!-- Title Header -->
    <body>
        <div class="title"> <a id="fade-header" href="../index.html">Nathaniel Woodthorpe</a></div>
        <div class="header">
            <span id="header-item">
                <a id="fade" href="../projects.html">Projects</a>
            </span>
            <span id="header-item">
                <a id="fade" href="index.html">Notes</a>
            </span>
            <span id="header-item">
                <a id="fade" href="http://github.com/NATHAN4" target="_blank">Github</a>
            </span>
            <span id="header-item">
                <a id="fade" href="../resume.pdf" target="_blank">Resume</a>
            </span>
            <span id="header-item">
                <a id="fade" href="mailto: njwoodthorpe@gmail.com">Contact</a>
            </span>
        </div>
        <hr>
        <!-- Scripts -->
        <script type="text/javascript">
            var userip;
        </script>
       <script type="text/javascript" src="https://l2.io/ip.js?var=userip"></script>
        <script>
            var chosenCourse = "";
            var chosenMonth = "";

            function trafficAnalysis(){
                var mobile = false;
                var ip = userip;
                if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
                    mobile = true;
                }
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = function() {
                    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                        console.log(xmlhttp.responseText);
                        if(xmlhttp.responseText == "recorded"){
                            console.log("Analysis Recorded...");
                        }else{
                            console.log("Analysis not recorded...");
                        }
                    }
                }
                xmlhttp.open("GET", "submittraffic.php?mobile=" + mobile + "&ip=" + ip, true);
                xmlhttp.send();
            }

            function loadNotes(course, month){
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = function() {
                    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                        var noteSpan = document.getElementById("avaliableNotesSpan");
                        if(xmlhttp.responseText != "none"){
                            var response = xmlhttp.responseText;
                            var responseArray = response.split(".pdf");
                            var path = course + "/" + month + "/";
                            var spanString = "";
                            spanString = "<table>";
                            for(var i = 0; i<responseArray.length - 1; i++){
                                var day = responseArray[i].substring(0, 2);
                                var year = responseArray[i].substring(4, 6);
                                var title =  responseArray[i].substr(responseArray[i].indexOf("!") + 1); //All chars after ;
                                title = title.split("_").join(" ");
                                spanString = spanString + "<tr><td>" + month + " " + day + ", 20" + year + "</td><td>" + title + "</td><td>" + "<a target=\"_blank\" href='" + path + responseArray[i] + ".pdf'>PDF</a></td></tr>";
                                console.log(responseArray[i]);
                            }
                            spanString = spanString + "</table>";
                            noteSpan.innerHTML = spanString;
                        }else{
                            noteSpan.innerHTML = "No notes!";
                        }
                    }
                }
                xmlhttp.open("GET", "findnotes.php?course=" + course + "&month=" + month, true);
                xmlhttp.send();
            }
            function getMonth(monthStr){
                return new Date(monthStr+'-1-01').getMonth()+1
            }
            
            function removeOptions(selectbox){
                var i;
                for(i=selectbox.options.length-1;i>=0;i--)
                {
                    selectbox.remove(i);
                }
            }

            function courseChosen(){
                var select = document.getElementById("course");
                var selectedCourse = select.options[select.selectedIndex].text;
                if(selectedCourse != "Choose a Course" && select.options[select.selectedIndex].value != "top"){
                    chosenCourse = selectedCourse;
                    var xmlhttp = new XMLHttpRequest();
                    xmlhttp.onreadystatechange = function() {
                        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                            console.log(xmlhttp.responseText);
                            var months = (xmlhttp.responseText).split("!");
                            months.pop();
                            months.sort(function(a, b){
                                a = getMonth(a);
                                b = getMonth(b);
                                if (a < b) {
                                    return -1;
                                } else if (a > b) {
                                        return 1;
                                } else {
                                        return 0;
                                }
                            })
                            var month = document.getElementById("month");
                            removeOptions(month);
                            var top = document.createElement('option');
                            top.value="Choose a Month";
                            top.innerHTML="Choose a Month";
                            month.appendChild(top);
                            for(var i = 0; i<months.length; i++){
                                var option = document.createElement('option');
                                option.value = months[i];
                                option.innerHTML = months[i];
                                month.appendChild(option);
                            }
                        }
                    }
                    xmlhttp.open("GET", "avalmonths.php?course=" + selectedCourse, true);
                    xmlhttp.send();
                }
            }

            function monthChosen(){
                var monthSelector = document.getElementById("month");
                var selectedMonth = monthSelector.options[monthSelector.selectedIndex].text;
                if(selectedMonth != "Choose a Month"){
                    chosenMonth = selectedMonth;
                    
                    loadNotes(chosenCourse, chosenMonth);
                }
            }

            window.onload=trafficAnalysis;
        </script>
        <!-- Main Content -->
        <div class="subtitle">
            Notes
        </div>
        
        <div class="selectcourse" id="selectcourse">
            <select class="textbox" onchange="courseChosen()" id="course">
                <option value="top">Choose a Course</option>
                <option value="Math135">Math135</option>
                <option value="Math137">Math137</option>
                <option value="top" disabled>-------</option>
                <option value="Math135">Math136</option>
                <option value="Math137">Math138</option>
            </select>
        </div>
        <div class="selectmonth" id="selectmonth">
            <select class="textbox" onchange="monthChosen()" id="month">
                <option value="top">Choose a Month</option>            
            </select>
        </div>
        <center>
        <div class="table" id="avaliableNotesSpan">
        
        </div>
        </center>
    </body>
</html>